@rendermode InteractiveServer

@if (ViewModel is not null)
{
    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Stretch" Gap="1">
        @* Layout *@
        <RadzenPanel AllowCollapse="true">
            <HeaderTemplate>
                <RadzenText TextStyle="TextStyle.H6">Layout</RadzenText>
            </HeaderTemplate>
            <ChildContent>
            </ChildContent>
        </RadzenPanel>
        @* Tree *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="10">
                    <RadzenText TextStyle="TextStyle.H6">Tree</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Style="padding-top: 3px">
                        <RadzenText Style="@sidebarFormLabelStyle">Scale X:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Scale Y:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Branch thickness:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenSlider TValue="int" Min="10" Max="3000" Step="10" @bind-Value="ViewModel.XScale.Value" Style="@sidebarFormValueStyle" />
                        <RadzenSlider TValue="int" Min="1" Max="300" @bind-Value="ViewModel.YScale.Value" Style="@sidebarFormValueStyle" />
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.BranchThickness.Value" Style="@sidebarFormValueStyle" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Search *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="10">
                    <RadzenText TextStyle="TextStyle.H6">Search</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                    <RadzenTextBox @bind-Value="ViewModel.SearchQuery.Value" Style="width: 220px; height: 30px" />
                    <RadzenButton Icon="search" Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Dark" Variant="Variant.Text" Click="ViewModel.SearchCommand.ToDelegate()" />
                </RadzenStack>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch" Style="padding-top: 3px">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenText Style="@sidebarFormLabelStyle">Target:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Ignore case:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Use regex:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenDropDown Data="Enum.GetValues<TreeSearchTarget>()" @bind-Value="ViewModel.SearchTarget.Value" Style="@sidebarFormValueStyle" />
                        <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.SearchOnIgnoreCase.Value" Style="margin-top: 2px; margin-bottom: 2px" />
                        <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.SearchWithRegex.Value" Style="margin-top: 2px; margin-bottom: 2px" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Leaves *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="10">
                    <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.ShowLeafLabels.Value" />
                    <RadzenText TextStyle="TextStyle.H6">Leaves</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch" Style="padding-top: 3px">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenText Style="@sidebarFormLabelStyle">Font size:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.LeafLabelsFontSize.Value" Style="@sidebarFormValueStyle" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Node values *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch" Gap="10">
                    <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.ShowNodeValues.Value" />
                    <RadzenText TextStyle="TextStyle.H6">Node values</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Style="padding-top: 3px">
                        <RadzenText Style="@sidebarFormLabelStyle">Value:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Font size:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenDropDown TValue="CladeValueType" Data="Enum.GetValues<CladeValueType>()" @bind-Value="ViewModel.NodeValueType.Value" Style="@sidebarFormValueStyle" />
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.NodeValueFontSize.Value" Style="@sidebarFormValueStyle" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Branch values *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch" Gap="10">
                    <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.ShowBranchValues.Value" />
                    <RadzenText TextStyle="TextStyle.H6">Branch values</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Style="padding-top: 3px">
                        <RadzenText Style="@sidebarFormLabelStyle">Value:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Font size:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Hide pattern:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenDropDown TValue="CladeValueType" Data="Enum.GetValues<CladeValueType>()" @bind-Value="ViewModel.BranchValueType.Value" Style="@sidebarFormValueStyle" />
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.BranchValueFontSize.Value" Style="@sidebarFormValueStyle" />
                        <RadzenTextBox @bind-Value="ViewModel.BranchValueHideRegexPattern.Value" Style="@sidebarFormValueStyle" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Branch decorations *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch" Gap="10">
                    <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.ShowBranchDecorations.Value" />
                    <RadzenText TextStyle="TextStyle.H6">Branch decorations</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenButton Icon="add" Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Dark" Variant="Variant.Text" Click="ViewModel.AddBranchDecorationCommand.ToDelegate()" />
                <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Stretch">
                    @foreach (BranchDecorationViewModel currentViewModel in ViewModel.BranchDecorations)
                    {
                        <RadzenPanel class="rz-border-radius" AllowCollapse="true" Style="background-color: whitesmoke">
                            <HeaderTemplate>
                                <RadzenText Style="font-size: 1.1rem">@currentViewModel.TargetRegexPattern.Value</RadzenText>
                            </HeaderTemplate>
                            <ChildContent>
                                <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch">
                                        <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Style="padding-top: 3px">
                                            <RadzenText Style="@sidebarFormLabelStyle">Pattern:</RadzenText>
                                            <RadzenText Style="@sidebarFormLabelStyle">Shape:</RadzenText>
                                            <RadzenText Style="@sidebarFormLabelStyle">Size:</RadzenText>
                                            <RadzenText Style="@sidebarFormLabelStyle">Color:</RadzenText>
                                        </RadzenStack>
                                        <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                                            <RadzenTextBox @bind-Value="currentViewModel.TargetRegexPattern.Value" Style="@sidebarFormValueStyle" />
                                            <RadzenDropDown TValue="BranchDecorationType" Data="Enum.GetValues<BranchDecorationType>()" @bind-Value="currentViewModel.DecorationType.Value" Style="@sidebarFormValueStyle" />
                                            <RadzenNumeric TValue="int" Min="1" @bind-Value="currentViewModel.ShapeSize.Value" Style="@sidebarFormValueStyle" />
                                            <RadzenColorPicker @bind-Value="currentViewModel.ShapeColor.Value" Style="@sidebarFormValueStyle" />
                                        </RadzenStack>
                                    </RadzenStack>
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                        <RadzenButton Icon="@(currentViewModel.Visible.Value ? "visibility" : "visibility_off")" Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Dark" Variant="Variant.Text" Click="x => currentViewModel.Visible.Value = !currentViewModel.Visible.Value" />
                                        <RadzenButton Icon="delete" Size="ButtonSize.Small" ButtonStyle="ButtonStyle.Danger" Variant="Variant.Text" Click="currentViewModel.DeleteSelfCommand.ToDelegate()" />
                                    </RadzenStack>
                                </RadzenStack>
                            </ChildContent>
                        </RadzenPanel>
                    }
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
        @* Scale bar *@
        <RadzenPanel AllowCollapse="true" Collapsed="defaultCollapsed">
            <HeaderTemplate>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Gap="10">
                    <RadzenCheckBox TValue="bool" @bind-Value="ViewModel.ShowScaleBar.Value" />
                    <RadzenText TextStyle="TextStyle.H6">Scale bar</RadzenText>
                </RadzenStack>
            </HeaderTemplate>
            <ChildContent>
                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Stretch">
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start" Style="padding-top: 3px">
                        <RadzenText Style="@sidebarFormLabelStyle">Value:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Font size:</RadzenText>
                        <RadzenText Style="@sidebarFormLabelStyle">Bar thickness:</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Start">
                        <RadzenNumeric TValue="double" Min="0" Step="0.1" @bind-Value="ViewModel.ScaleBarValue.Value" Style="@sidebarFormValueStyle" />
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.ScaleBarFontSize.Value" Style="@sidebarFormValueStyle" />
                        <RadzenNumeric TValue="int" Min="1" @bind-Value="ViewModel.ScaleBarThickness.Value" Style="@sidebarFormValueStyle" />
                    </RadzenStack>
                </RadzenStack>
            </ChildContent>
        </RadzenPanel>
    </RadzenStack>
}

@code {
    private const bool defaultCollapsed =
#if DEBUG
    false;
#else
    true;
#endif
    private const string sidebarFormLabelStyle = "width: 150px; height: 23px";
    private const string sidebarFormValueStyle = "width: 100px; height: 30px";

    [Parameter]
    public HomeViewModel? ViewModel { get; set; }
}
